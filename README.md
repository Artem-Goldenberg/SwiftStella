#  SwiftStella

Parser and data structures library for working with 
the [stella](https://fizruk.github.io/stella/) language in Swift.

Code generated by the ANTLR for Swift is terrible... So this package provides a more
convenient interface to access Stella's syntax constructions as well as the parser
built on top of the [SwiftParsec](https://github.com/davedufresne/SwiftParsec) 
library, which is a port of the original Haskell's Parsec library to Swfit.

## Installation

### Dependency for swift package manager

To use this package inside another swift package,
 add the following dependency to your `Package.swift` file:
 ```Swift
dependencies: [
    .package(url: "https://github.com/Artem-Goldenberg/SwiftStella", from: "1.0.0")
],
 ```
 
 Then you can include this package as a module in normal Swift files like this:
 ```Swift
 import Stella
 ```

### Cloning for testing and development

If you want to clone this package and run tests for the parser, you need to clone
the repository with this submodule [repository](https://github.com/Zelourses/stella-tests)
containing example Stella programs, on which the parser is being tested.  
To do it you can simply use:
```
git clone --recurse-submodules "https://github.com/Artem-Goldenberg/SwiftStella.git"
```

After that, you can build the package or run tests using
```
swift build
swift test
```
Don't forget to install [Swift](https://www.swift.org/install) if you don't have it.

> For development version there is also a `TestGenerator` executable target, which
  parses current test files and prints serizlized program trees to the `printed-trees`
  folder, this is how you can generate new tests. To run it, switch to the repository
  root directory and execute `swift run TestGenerator` command.


## How to use

Quicker to demonstrate by an example:

```Swift
import Stella

func parse(sourceText: String) throws {
    // get Parsec parsers for Stella's syntactic elements by using 
    // the static attribute `parser` on them, see library sources
    // (or explore with `Stella.` completions) for all syntax elements
    let stellaParser = Stella.Program.parser //Â or just use Program.parser
    
    // you can use Parsec parser's `run` method to run the parser on the specified text
    // and source file name (for error messages). See docs for Swift's Parsec library, if
    // you want to learn more about how to work with these parsers
    let program: Program = try stellaParser.run(
        sourceName: "somefilename.stella",
        input: sourceText
    )
    
    let declarations = program.declarations // get the list of all declarations
    
    // now you can do whatever you want with them:
    for decl in declarations {
        switch decl {
            case .function(_, name, params, returnType, _, body, returnExpr):
                ...
            case .genericFunction(...):
                ...
            ...
        } 
    }
}
```

See [Syntax.swift](Sources/Stella/Syntax.swift) and [Type.swift](Sources/Stella/Type.swift)
files for all cases and all syntax elements of the Stella language.
